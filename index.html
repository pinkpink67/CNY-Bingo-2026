<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mobile Bingo Game</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: #333;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            width: 100%;
            max-width: 500px;
            background-color: white;
            border-radius: 20px;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            margin: 20px 0;
        }
        
        .header {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            text-align: center;
            padding: 25px 20px;
        }
        
        .header h1 {
            font-size: 1.8rem;
            margin-bottom: 5px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 0.95rem;
        }
        
        .content {
            padding: 25px 20px;
            position: relative;
            min-height: 500px;
        }
        
        /* Login Screen */
        #loginScreen {
            text-align: center;
        }
        
        .login-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 25px;
        }
        
        .input-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
            text-align: left;
        }
        
        .input-group label {
            font-weight: 600;
            font-size: 1rem;
        }
        
        .input-group input {
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1rem;
        }
        
        .input-group input:focus {
            border-color: #6a11cb;
            outline: none;
        }
        
        .btn {
            padding: 16px;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .btn-primary {
            background-color: #6a11cb;
            color: white;
        }
        
        .btn-secondary {
            background-color: #f0f0f0;
            color: #333;
        }
        
        .players-count {
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 10px;
            font-size: 0.9rem;
        }
        
        .players-count span {
            font-weight: 700;
            color: #6a11cb;
        }
        
        .admin-login-link {
            margin-top: 15px;
            font-size: 0.9rem;
        }
        
        .admin-login-link a {
            color: #6a11cb;
            text-decoration: none;
            font-weight: 600;
        }
        
        /* Game Screen */
        #gameScreen {
            display: none;
        }
        
        .player-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .player-name {
            font-size: 1.3rem;
            font-weight: 700;
            color: #6a11cb;
        }
        
        .card-counter {
            background-color: #f0f0f0;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: 600;
        }
        
        .bingo-card-container {
            background-color: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
        }
        
        .bingo-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
        }
        
        .bingo-cell {
            aspect-ratio: 1;
            background-color: white;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.2rem;
            cursor: pointer;
            user-select: none;
            box-shadow: 0 3px 5px rgba(0, 0, 0, 0.05);
        }
        
        .bingo-cell.free {
            background-color: #ffd166;
            color: #333;
        }
        
        .bingo-cell.marked {
            background-color: #6a11cb;
            color: white;
        }
        
        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .controls .btn {
            flex: 1;
        }
        
        .footer {
            margin-top: 20px;
            text-align: center;
            font-size: 0.85rem;
            color: #777;
        }
        
        /* Password Display */
        .password-display {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            padding: 12px 25px;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            color: white;
            display: none;
            z-index: 100;
            box-shadow: 0 5px 15px rgba(106, 17, 203, 0.3);
            min-width: 250px;
            text-align: center;
        }
        
        /* Confirmation Dialog */
        .confirmation-dialog {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 10000;
            display: none;
            justify-content: center;
            align-items: center;
        }
        
        .confirmation-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 400px;
            width: 90%;
            text-align: center;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.2);
        }
        
        .confirmation-buttons {
            display: flex;
            gap: 15px;
            margin-top: 25px;
            justify-content: center;
        }
        
        .confirmation-buttons .btn {
            flex: 1;
        }
        
        /* Admin Screen */
        #adminScreen {
            display: none;
        }
        
        .admin-controls {
            margin-top: 25px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .textarea-group, .input-group-admin {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .textarea-group label, .input-group-admin label {
            font-weight: 600;
            font-size: 1rem;
        }
        
        .textarea-group textarea, .input-group-admin input {
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1rem;
        }
        
        .textarea-group textarea {
            min-height: 150px;
            resize: vertical;
        }
        
        .textarea-group textarea:focus, .input-group-admin input:focus {
            border-color: #6a11cb;
            outline: none;
        }
        
        .admin-settings {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
        }
        
        @media (max-width: 480px) {
            .container {
                border-radius: 15px;
            }
            
            .header {
                padding: 20px 15px;
            }
            
            .content {
                padding: 20px 15px;
            }
            
            .bingo-cell {
                font-size: 1rem;
            }
            
            .password-display {
                min-width: 200px;
                font-size: 1rem;
                padding: 10px 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Confirmation Dialog -->
    <div class="confirmation-dialog" id="confirmationDialog">
        <div class="confirmation-content">
            <h3><i class="fas fa-user-check"></i> Welcome Back!</h3>
            <p>Name "<span id="returningPlayerName"></span>" is already registered.</p>
            <p>Is this you? Would you like to continue with your existing cards?</p>
            
            <div class="confirmation-buttons">
                <button class="btn btn-secondary" id="confirmNewPlayerBtn">
                    <i class="fas fa-user-times"></i> No, I'm Different
                </button>
                <button class="btn btn-primary" id="confirmReturningPlayerBtn">
                    <i class="fas fa-sign-in-alt"></i> Yes, It's Me
                </button>
            </div>
        </div>
    </div>
    
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-dice"></i> Mobile Bingo</h1>
            <p>Login to play with your unique bingo cards</p>
        </div>
        
        <div class="content">
            <!-- Login Screen -->
            <div id="loginScreen">
                <h2>Welcome to Bingo!</h2>
                <p>Enter your name and password to join the game.</p>
                
                <form class="login-form" id="loginForm">
                    <div class="input-group">
                        <label for="playerName">Your Name</label>
                        <input type="text" id="playerName" placeholder="Enter your name" required autocomplete="off">
                    </div>
                    
                    <div class="input-group">
                        <label for="playerPassword">Password</label>
                        <input type="password" id="playerPassword" placeholder="Enter password (default: 8888)" required>
                    </div>
                    
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-sign-in-alt"></i> Join Game
                    </button>
                </form>
                
                <div class="players-count">
                    Players joined: <span id="currentPlayers">0</span> / <span id="maxPlayers">30</span>
                </div>
                
                <div class="admin-login-link">
                    <a href="#" id="adminLoginLink">Admin Login</a>
                </div>
            </div>
            
            <!-- Game Screen -->
            <div id="gameScreen">
                <div class="player-info">
                    <div class="player-name" id="displayPlayerName">Player</div>
                    <div class="card-counter">Card <span id="currentCard">1</span> of <span id="totalCards">3</span></div>
                </div>
                
                <div class="bingo-card-container">
                    <div class="bingo-grid" id="bingoGrid">
                        <!-- Bingo cells will be generated here -->
                    </div>
                </div>
                
                <div class="controls">
                    <button class="btn btn-secondary" id="prevCardBtn">
                        <i class="fas fa-arrow-left"></i> Back
                    </button>
                    <button class="btn btn-primary" id="nextCardBtn">
                        Next <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </div>
            
            <!-- Admin Screen -->
            <div id="adminScreen">
                <h2><i class="fas fa-cogs"></i> Admin Controls</h2>
                <p>For admin access, use ID: <strong>admin</strong> and Password: <strong>1234</strong></p>
                
                <div class="admin-controls">
                    <div class="textarea-group">
                        <label for="playerList">Authorized Player Names (comma-separated)</label>
                        <textarea id="playerList" placeholder="Enter player names, e.g., Calvin, JF, Cindy, PIG">Calvin, JF, Cindy, PIG</textarea>
                    </div>
                    
                    <div class="admin-settings">
                        <h3><i class="fas fa-sliders-h"></i> Game Settings</h3>
                        
                        <div class="input-group-admin">
                            <label for="maxPlayers">Maximum Players (1-100)</label>
                            <input type="number" id="maxPlayers" min="1" max="100" value="30">
                        </div>
                        
                        <div class="input-group-admin">
                            <label for="cardsPerPlayer">Cards per Player (1-10)</label>
                            <input type="number" id="cardsPerPlayer" min="1" max="10" value="3">
                        </div>
                        
                        <div class="input-group-admin">
                            <label for="playerPasswordSetting">Default Player Password (alphanumeric)</label>
                            <input type="text" id="playerPasswordSetting" value="8888">
                        </div>
                    </div>
                    
                    <button class="btn btn-primary" id="saveSettingsBtn">
                        <i class="fas fa-save"></i> Save All Settings
                    </button>
                    
                    <button class="btn btn-secondary" id="adminLogoutBtn">
                        <i class="fas fa-sign-out-alt"></i> Exit Admin
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Lucky 4D Number Display (Fixed at bottom center) -->
    <div class="password-display" id="passwordDisplay">
        Lucky 4D Number: <span id="luckyNumber">XXXX</span>
    </div>
    
    <div class="footer">
        <p>Mobile Bingo Game &copy; 2023</p>
    </div>

    <script>
        // ==================== GAME STATE ====================
        
        let gameState = {
            players: [],
            currentPlayer: null,
            currentCardIndex: 0,
            settings: {
                maxPlayers: 30,
                cardsPerPlayer: 3,
                defaultPassword: "8888",
                authorizedPlayers: ["Calvin", "JF", "Cindy", "PIG"]
            }
        };
        
        const ADMIN_CREDENTIALS = {
            id: "admin",
            password: "1234"
        };
        
        // Variables to track login attempts
        let pendingLoginName = '';
        let existingPlayerFound = null;
        
        // ==================== GAME FUNCTIONS ====================
        
        function generateBingoCards(count) {
            const cards = [];
            const ranges = {
                B: [1, 15],
                I: [16, 30],
                N: [31, 45],
                G: [46, 60],
                O: [61, 75]
            };
            
            // Generate cards based on count parameter
            for (let cardId = 1; cardId <= count; cardId++) {
                const card = { id: cardId, numbers: {} };
                
                for (let col = 0; col < 5; col++) {
                    const letter = Object.keys(ranges)[col];
                    const [min, max] = ranges[letter];
                    const columnNumbers = [];
                    
                    while (columnNumbers.length < 5) {
                        const num = Math.floor(Math.random() * (max - min + 1)) + min;
                        if (!columnNumbers.includes(num)) {
                            columnNumbers.push(num);
                        }
                    }
                    
                    card.numbers[letter] = columnNumbers;
                }
                
                card.numbers.N[2] = "FREE";
                cards.push(card);
            }
            
            return cards;
        }
        
        function generate4DPassword() {
            // Generate a random 4-digit number (0000-9999)
            return Math.floor(1000 + Math.random() * 9000).toString();
        }
        
        function assignCardsToPlayer(player, cardsPool, count) {
            const assignedCards = [];
            const cardsToAssign = count || gameState.settings.cardsPerPlayer;
            
            // Get available cards (not issued yet)
            const availableCards = cardsPool.filter(card => 
                !gameState.players.some(p => 
                    p.cards && p.cards.some(c => c.id === card.id)
                )
            );
            
            const cardsToUse = availableCards.length >= cardsToAssign ? availableCards : cardsPool;
            
            for (let i = 0; i < cardsToAssign; i++) {
                if (cardsToUse.length === 0) break;
                
                const randomIndex = Math.floor(Math.random() * cardsToUse.length);
                const selectedCard = cardsToUse[randomIndex];
                assignedCards.push(selectedCard);
                cardsToUse.splice(randomIndex, 1);
            }
            
            player.cards = assignedCards;
            return assignedCards;
        }
        
        function updateCardDisplay() {
            if (!gameState.currentPlayer || !gameState.currentPlayer.cards) return;
            
            const card = gameState.currentPlayer.cards[gameState.currentCardIndex];
            if (!card) return;
            
            const bingoGrid = document.getElementById('bingoGrid');
            const currentCardSpan = document.getElementById('currentCard');
            
            currentCardSpan.textContent = gameState.currentCardIndex + 1;
            bingoGrid.innerHTML = '';
            
            const letters = ['B', 'I', 'N', 'G', 'O'];
            
            for (let row = 0; row < 5; row++) {
                for (let col = 0; col < 5; col++) {
                    const cell = document.createElement('div');
                    const letter = letters[col];
                    const number = card.numbers[letter][row];
                    
                    cell.className = 'bingo-cell';
                    cell.textContent = number;
                    
                    if (col === 2 && row === 2) {
                        cell.classList.add('free');
                    }
                    
                    cell.addEventListener('click', function() {
                        if (!this.classList.contains('free')) {
                            this.classList.toggle('marked');
                        }
                    });
                    
                    bingoGrid.appendChild(cell);
                }
            }
        }
        
        function updatePasswordDisplay() {
            const passwordDisplay = document.getElementById('passwordDisplay');
            const luckyNumberSpan = document.getElementById('luckyNumber');
            
            if (gameState.currentPlayer && gameState.currentPlayer.luckyNumber) {
                passwordDisplay.style.display = 'block';
                luckyNumberSpan.textContent = gameState.currentPlayer.luckyNumber;
            } else {
                passwordDisplay.style.display = 'none';
            }
        }
        
        // ==================== UI FUNCTIONS ====================
        
        function showScreen(screenId) {
            ['loginScreen', 'gameScreen', 'adminScreen'].forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.style.display = id === screenId ? 'block' : 'none';
                }
            });
        }
        
        function updatePlayersCount() {
            const currentPlayersElement = document.getElementById('currentPlayers');
            const maxPlayersElement = document.getElementById('maxPlayers');
            
            if (currentPlayersElement) {
                currentPlayersElement.textContent = gameState.players.length;
            }
            if (maxPlayersElement) {
                maxPlayersElement.textContent = gameState.settings.maxPlayers;
            }
        }
        
        function showConfirmationDialog(playerName) {
            document.getElementById('returningPlayerName').textContent = playerName;
            document.getElementById('confirmationDialog').style.display = 'flex';
        }
        
        function hideConfirmationDialog() {
            document.getElementById('confirmationDialog').style.display = 'none';
        }
        
        function showCustomAlert(message, isFirstTime = false) {
            // Create custom dialog
            const dialog = document.createElement('div');
            dialog.className = 'confirmation-dialog';
            dialog.style.display = 'flex';
            
            const content = document.createElement('div');
            content.className = 'confirmation-content';
            
            let icon = '<i class="fas fa-info-circle"></i>';
            let title = 'Information';
            let buttons = `
                <div class="confirmation-buttons">
                    <button class="btn btn-primary" id="customAlertOkBtn">
                        OK
                    </button>
                </div>
            `;
            
            if (isFirstTime) {
                icon = '<i class="fas fa-gift"></i>';
                title = 'Welcome!';
                buttons = `
                    <div class="confirmation-buttons">
                        <button class="btn btn-primary" id="customAlertOkBtn">
                            <i class="fas fa-thumbs-up"></i> Got it!
                        </button>
                    </div>
                `;
            }
            
            content.innerHTML = `
                <h3>${icon} ${title}</h3>
                <div style="text-align: left; line-height: 1.6;">
                    ${message}
                </div>
                ${buttons}
            `;
            
            dialog.appendChild(content);
            document.body.appendChild(dialog);
            
            // Add event listener to close button
            document.getElementById('customAlertOkBtn').addEventListener('click', function() {
                document.body.removeChild(dialog);
            });
        }
        
        // ==================== EVENT HANDLERS ====================
        
        function setupEventListeners() {
            // Login form
            const loginForm = document.getElementById('loginForm');
            if (loginForm) {
                loginForm.addEventListener('submit', handleLogin);
            }
            
            // Admin login link
            const adminLink = document.getElementById('adminLoginLink');
            if (adminLink) {
                adminLink.addEventListener('click', showAdminLogin);
            }
            
            // Navigation buttons
            const prevBtn = document.getElementById('prevCardBtn');
            const nextBtn = document.getElementById('nextCardBtn');
            if (prevBtn) prevBtn.addEventListener('click', showPrevCard);
            if (nextBtn) nextBtn.addEventListener('click', showNextCard);
            
            // Admin logout button
            const adminLogoutBtn = document.getElementById('adminLogoutBtn');
            if (adminLogoutBtn) adminLogoutBtn.addEventListener('click', () => {
                showScreen('loginScreen');
                // Clear admin fields
                const playerNameInput = document.getElementById('playerName');
                const playerPasswordInput = document.getElementById('playerPassword');
                if (playerNameInput) playerNameInput.value = '';
                if (playerPasswordInput) playerPasswordInput.value = '';
            });
            
            // Confirmation dialog buttons
            document.getElementById('confirmReturningPlayerBtn').addEventListener('click', function() {
                hideConfirmationDialog();
                loginAsReturningPlayer();
            });
            
            document.getElementById('confirmNewPlayerBtn').addEventListener('click', function() {
                hideConfirmationDialog();
                // Go back to login page for user to choose different name
                const playerNameInput = document.getElementById('playerName');
                const playerPasswordInput = document.getElementById('playerPassword');
                if (playerNameInput) {
                    playerNameInput.value = '';
                    playerNameInput.focus();
                }
                if (playerPasswordInput) {
                    playerPasswordInput.value = '';
                }
            });
            
            // Admin controls
            const saveSettingsBtn = document.getElementById('saveSettingsBtn');
            if (saveSettingsBtn) {
                saveSettingsBtn.addEventListener('click', saveAdminSettings);
            }
        }
        
        function handleLogin(e) {
            e.preventDefault();
            
            const playerNameInput = document.getElementById('playerName');
            const playerPasswordInput = document.getElementById('playerPassword');
            const playerName = playerNameInput ? playerNameInput.value.trim() : '';
            const password = playerPasswordInput ? playerPasswordInput.value.trim() : '';
            
            if (!playerName) {
                showCustomAlert('Please enter your name');
                return;
            }
            
            if (!password) {
                showCustomAlert('Please enter your password');
                return;
            }
            
            // Check for admin login
            if (playerName.toLowerCase() === ADMIN_CREDENTIALS.id) {
                if (password === ADMIN_CREDENTIALS.password) {
                    showScreen('adminScreen');
                    // Load current settings into admin panel
                    loadAdminSettings();
                    if (playerNameInput) playerNameInput.value = '';
                    if (playerPasswordInput) playerPasswordInput.value = '';
                } else {
                    showCustomAlert('Invalid admin password');
                }
                return;
            }
            
            // Check if player name is authorized (case-insensitive)
            const isAuthorized = gameState.settings.authorizedPlayers.some(name => 
                name.trim().toLowerCase() === playerName.toLowerCase()
            );
            
            if (!isAuthorized) {
                showCustomAlert(`Sorry, "${playerName}" is not on the authorized players list.`);
                return;
            }
            
            // Check password against default password
            if (password !== gameState.settings.defaultPassword) {
                showCustomAlert('Incorrect password. Please use the default password: ' + gameState.settings.defaultPassword);
                return;
            }
            
            // Store the name being attempted
            pendingLoginName = playerName;
            
            // Check if name already exists (case-insensitive)
            existingPlayerFound = gameState.players.find(p => 
                p.name.toLowerCase() === playerName.toLowerCase()
            );
            
            if (existingPlayerFound) {
                // Player exists, show confirmation dialog
                showConfirmationDialog(playerName);
            } else {
                // New player, create account
                createNewPlayer(playerName);
            }
            
            // Clear input fields
            if (playerNameInput) playerNameInput.value = '';
            if (playerPasswordInput) playerPasswordInput.value = '';
        }
        
        function loginAsReturningPlayer() {
            if (!existingPlayerFound) return;
            
            gameState.currentPlayer = existingPlayerFound;
            gameState.currentCardIndex = 0;
            
            document.getElementById('displayPlayerName').textContent = existingPlayerFound.name;
            document.getElementById('totalCards').textContent = existingPlayerFound.cards.length;
            updateCardDisplay();
            updatePasswordDisplay();
            showScreen('gameScreen');
            
            // Reset tracking variables
            pendingLoginName = '';
            existingPlayerFound = null;
        }
        
        function createNewPlayer(playerName) {
            // Check player limit
            if (gameState.players.length >= gameState.settings.maxPlayers) {
                showCustomAlert(`Sorry, the game is full! Maximum ${gameState.settings.maxPlayers} players allowed.`);
                return;
            }
            
            // Generate cards pool (enough for all potential players)
            const totalCardsNeeded = gameState.settings.maxPlayers * gameState.settings.cardsPerPlayer;
            const cardsPool = generateBingoCards(totalCardsNeeded);
            
            // Generate a Lucky 4D number
            const luckyNumber = generate4DPassword();
            
            // Create player
            const newPlayer = {
                id: gameState.players.length + 1,
                name: playerName,
                luckyNumber: luckyNumber,
                cards: []
            };
            
            // Assign cards
            assignCardsToPlayer(newPlayer, cardsPool, gameState.settings.cardsPerPlayer);
            
            // Add to game state
            gameState.players.push(newPlayer);
            gameState.currentPlayer = newPlayer;
            gameState.currentCardIndex = 0;
            
            // Update UI
            document.getElementById('displayPlayerName').textContent = newPlayer.name;
            document.getElementById('totalCards').textContent = newPlayer.cards.length;
            updateCardDisplay();
            updatePasswordDisplay();
            updatePlayersCount();
            showScreen('gameScreen');
            
            // Save to localStorage
            saveGameState();
            
            // Show welcome message with Lucky 4D number
            const welcomeMessage = `
                <strong>Welcome ${playerName}!</strong><br><br>
                You have received ${newPlayer.cards.length} BINGO cards.<br><br>
                <strong>Your Lucky 4D number: ${luckyNumber}</strong><br><br>
                Remember this number for future reference!<br>
                (Your login password remains: ${gameState.settings.defaultPassword})
            `;
            
            showCustomAlert(welcomeMessage, true);
        }
        
        function showAdminLogin(e) {
            if (e) e.preventDefault();
            
            const adminId = prompt('Enter Admin ID:');
            if (!adminId) return;
            
            if (adminId !== ADMIN_CREDENTIALS.id) {
                alert('Invalid Admin ID');
                return;
            }
            
            const password = prompt('Enter Admin Password:');
            if (!password) return;
            
            if (password !== ADMIN_CREDENTIALS.password) {
                alert('Invalid Password');
                return;
            }
            
            showScreen('adminScreen');
            loadAdminSettings();
        }
        
        function loadAdminSettings() {
            // Load current settings into admin panel
            const playerListTextarea = document.getElementById('playerList');
            const maxPlayersInput = document.getElementById('maxPlayers');
            const cardsPerPlayerInput = document.getElementById('cardsPerPlayer');
            const playerPasswordSettingInput = document.getElementById('playerPasswordSetting');
            
            if (playerListTextarea) {
                playerListTextarea.value = gameState.settings.authorizedPlayers.join(', ');
            }
            if (maxPlayersInput) {
                maxPlayersInput.value = gameState.settings.maxPlayers;
            }
            if (cardsPerPlayerInput) {
                cardsPerPlayerInput.value = gameState.settings.cardsPerPlayer;
            }
            if (playerPasswordSettingInput) {
                playerPasswordSettingInput.value = gameState.settings.defaultPassword;
            }
        }
        
        function saveAdminSettings() {
            const playerListTextarea = document.getElementById('playerList');
            const maxPlayersInput = document.getElementById('maxPlayers');
            const cardsPerPlayerInput = document.getElementById('cardsPerPlayer');
            const playerPasswordSettingInput = document.getElementById('playerPasswordSetting');
            
            if (!playerListTextarea || !maxPlayersInput || !cardsPerPlayerInput || !playerPasswordSettingInput) return;
            
            // Get player list
            const playerListText = playerListTextarea.value.trim();
            const playerNames = playerListText.split(',')
                .map(name => name.trim())
                .filter(name => name.length > 0);
            
            // Get max players (1-100)
            let maxPlayers = parseInt(maxPlayersInput.value);
            if (isNaN(maxPlayers) || maxPlayers < 1) maxPlayers = 1;
            if (maxPlayers > 100) maxPlayers = 100;
            
            // Get cards per player (1-10)
            let cardsPerPlayer = parseInt(cardsPerPlayerInput.value);
            if (isNaN(cardsPerPlayer) || cardsPerPlayer < 1) cardsPerPlayer = 1;
            if (cardsPerPlayer > 10) cardsPerPlayer = 10;
            
            // Get default password
            const defaultPassword = playerPasswordSettingInput.value.trim();
            if (defaultPassword.length === 0) {
                showCustomAlert('Default password cannot be empty');
                return;
            }
            
            // Update settings
            gameState.settings.authorizedPlayers = playerNames;
            gameState.settings.maxPlayers = maxPlayers;
            gameState.settings.cardsPerPlayer = cardsPerPlayer;
            gameState.settings.defaultPassword = defaultPassword;
            
            // Save to localStorage
            saveGameState();
            
            // Update players count display
            updatePlayersCount();
            
            showCustomAlert(`
                <strong>Settings saved successfully!</strong><br><br>
                • Authorized players: ${playerNames.length}<br>
                • Maximum players: ${maxPlayers}<br>
                • Cards per player: ${cardsPerPlayer}<br>
                • Default password: ${defaultPassword}
            `);
        }
        
        function showPrevCard() {
            if (gameState.currentCardIndex > 0) {
                gameState.currentCardIndex--;
                updateCardDisplay();
            }
        }
        
        function showNextCard() {
            if (gameState.currentPlayer && 
                gameState.currentCardIndex < gameState.currentPlayer.cards.length - 1) {
                gameState.currentCardIndex++;
                updateCardDisplay();
            }
        }
        
        // ==================== DATA PERSISTENCE ====================
        
        function saveGameState() {
            try {
                localStorage.setItem('bingoGameState', JSON.stringify(gameState));
            } catch (error) {
                console.error('Failed to save game state:', error);
            }
        }
        
        function loadGameState() {
            try {
                const saved = localStorage.getItem('bingoGameState');
                if (saved) {
                    const parsed = JSON.parse(saved);
                    gameState.players = parsed.players || [];
                    gameState.settings = { 
                        ...gameState.settings, 
                        ...(parsed.settings || {}),
                        // Ensure all settings exist
                        authorizedPlayers: parsed.settings && parsed.settings.authorizedPlayers 
                            ? parsed.settings.authorizedPlayers 
                            : gameState.settings.authorizedPlayers,
                        maxPlayers: parsed.settings && parsed.settings.maxPlayers 
                            ? parsed.settings.maxPlayers 
                            : gameState.settings.maxPlayers,
                        cardsPerPlayer: parsed.settings && parsed.settings.cardsPerPlayer 
                            ? parsed.settings.cardsPerPlayer 
                            : gameState.settings.cardsPerPlayer,
                        defaultPassword: parsed.settings && parsed.settings.defaultPassword 
                            ? parsed.settings.defaultPassword 
                            : gameState.settings.defaultPassword
                    };
                }
            } catch (error) {
                console.error('Failed to load game state:', error);
            }
        }
        
        // ==================== INITIALIZATION ====================
        
        function initGame() {
            // Load saved game state
            loadGameState();
            
            // Update UI
            updatePlayersCount();
            
            // Setup event listeners
            setupEventListeners();
            
            // Show login screen
            showScreen('loginScreen');
        }
        
        // Start the game when page loads
        window.addEventListener('DOMContentLoaded', initGame);
        
    </script>
</body>
</html>
