<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mobile Bingo Game</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  body { font-family: 'Helvetica', sans-serif; background: #f2f2f2; }
  .card-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 4px; margin: 10px auto; max-width: 320px; }
  .cell { background: #fff; border: 1px solid #000; padding: 16px 0; text-align: center; font-weight: bold; font-size: 1.2rem; border-radius: 6px; user-select: none; }
  .cell.marked { background: #4ade80; color: white; }
  .btn { padding: 8px 16px; border-radius: 6px; font-weight: bold; }
</style>
</head>
<body>

<!-- Login Screen -->
<div id="login-screen" class="flex flex-col items-center justify-center min-h-screen">
  <h1 class="text-3xl font-bold mb-4">Bingo Game</h1>
  <input id="playerName" type="text" placeholder="Player Name" class="p-2 border rounded mb-2 w-64">
  <input id="playerPass" type="password" placeholder="Password" class="p-2 border rounded mb-4 w-64">
  <button id="loginBtn" class="bg-blue-500 text-white btn">Login</button>
  <p id="loginError" class="text-red-500 mt-2"></p>
</div>

<!-- Player Dashboard -->
<div id="player-dashboard" class="hidden flex flex-col items-center min-h-screen p-2">
  <div class="flex justify-between w-full max-w-md mb-2">
    <h2 id="playerDisplay" class="text-xl font-bold"></h2>
    <div id="luckNumber" class="text-lg font-bold border px-2 rounded bg-yellow-200"></div>
  </div>
  <div id="cardContainer" class="card-grid"></div>
  <div class="flex gap-4 mt-4">
    <button id="backCard" class="bg-gray-400 btn">Back</button>
    <button id="nextCard" class="bg-gray-400 btn">Next</button>
  </div>
  <button id="logoutBtn" class="mt-4 bg-red-500 text-white btn">Logout</button>
</div>

<!-- Admin Dashboard -->
<div id="admin-dashboard" class="hidden flex flex-col items-center min-h-screen p-4">
  <h1 class="text-2xl font-bold mb-4">Admin Panel</h1>
  <div class="flex flex-col max-w-md w-full">
    <label>New Player Name:</label>
    <input id="newPlayerName" type="text" class="p-2 border rounded mb-2">
    <label>New Player Password:</label>
    <input id="newPlayerPass" type="text" class="p-2 border rounded mb-2">
    <button id="addPlayerBtn" class="bg-green-500 text-white btn mb-4">Add Player</button>
    
    <h2 class="text-xl font-bold mb-2">Players List</h2>
    <ul id="playersList" class="mb-4"></ul>

    <button id="resetAllBtn" class="bg-red-500 text-white btn mb-4">Reset All Players</button>
    
    <h2 class="text-xl font-bold mb-2">Bingo Settings</h2>
    <label>Cards per Player (1-10):</label>
    <input id="cardsPerPlayer" type="number" min="1" max="10" class="p-2 border rounded mb-2">
    <button id="saveSettingsBtn" class="bg-blue-500 text-white btn mb-4">Save Settings</button>
  </div>
  <button id="adminLogoutBtn" class="mt-4 bg-red-500 text-white btn">Logout</button>
</div>

<script>
  // ====== Firebase Configuration ======
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
    databaseURL: "https://YOUR_PROJECT_ID.firebaseio.com",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_PROJECT_ID.appspot.com",
    messagingSenderId: "YOUR_SENDER_ID",
    appId: "YOUR_APP_ID"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // ====== Globals ======
  let currentPlayer = null;
  let currentCardIndex = 0;
  let totalCards = 1;

  // ====== Helpers ======
  function capitalizeFirst(str) { return str.charAt(0).toUpperCase() + str.slice(1).toLowerCase(); }

  function generateBingoCard() {
    // Standard 5x5 BINGO numbers
    const ranges = {B:[1,15], I:[16,30], N:[31,45], G:[46,60], O:[61,75]};
    let card = [];
    for(let col in ranges){
      let nums = [];
      while(nums.length < 5){
        let n = Math.floor(Math.random()*(ranges[col][1]-ranges[col][0]+1))+ranges[col][0];
        if(!nums.includes(n)) nums.push(n);
      }
      card.push(nums);
    }
    // Transpose to row-major
    let grid = [];
    for(let i=0;i<5;i++){
      grid.push([card.B[i], card.I[i], card.N[i], card.G[i], card.O[i]]);
    }
    grid[2][2] = "FREE";
    return grid;
  }

  function renderCard(cardData) {
    const container = document.getElementById('cardContainer');
    container.innerHTML = '';
    cardData.forEach((row, r)=>{
      row.forEach((cell,c)=>{
        const div = document.createElement('div');
        div.className = 'cell';
        div.textContent = cell;
        if(currentPlayer.cards[currentCardIndex].marks[r][c]) div.classList.add('marked');
        div.addEventListener('click', ()=>{
          currentPlayer.cards[currentCardIndex].marks[r][c] = !currentPlayer.cards[currentCardIndex].marks[r][c];
          div.classList.toggle('marked');
          db.ref('players/'+currentPlayer.id+'/cards').set(currentPlayer.cards);
        });
        container.appendChild(div);
      });
    });
  }

  // ====== Player Login ======
  document.getElementById('loginBtn').addEventListener('click', async ()=>{
    const name = capitalizeFirst(document.getElementById('playerName').value.trim());
    const pass = document.getElementById('playerPass').value.trim().toLowerCase();
    if(name === 'Admin' && pass === '1234'){
      document.getElementById('login-screen').classList.add('hidden');
      document.getElementById('admin-dashboard').classList.remove('hidden');
      loadAdminPanel();
      return;
    }

    const snapshot = await db.ref('players').once('value');
    let found = null;
    snapshot.forEach(s=>{
      const p = s.val();
      if(p.name === name && p.password.toLowerCase() === pass) found = {...p, id: s.key};
    });
    if(found){
      currentPlayer = found;
      totalCards = currentPlayer.cards.length;
      currentCardIndex = 0;
      document.getElementById('login-screen').classList.add('hidden');
      document.getElementById('player-dashboard').classList.remove('hidden');
      document.getElementById('playerDisplay').textContent = currentPlayer.name;
      document.getElementById('luckNumber').textContent = currentPlayer.luckNumber;
      renderCard(currentPlayer.cards[currentCardIndex].grid);
    } else {
      document.getElementById('loginError').textContent = 'Invalid Name or Password';
    }
  });

  document.getElementById('nextCard').addEventListener('click', ()=>{
    if(currentCardIndex < totalCards-1) currentCardIndex++;
    renderCard(currentPlayer.cards[currentCardIndex].grid);
  });
  document.getElementById('backCard').addEventListener('click', ()=>{
    if(currentCardIndex > 0) currentCardIndex--;
    renderCard(currentPlayer.cards[currentCardIndex].grid);
  });
  document.getElementById('logoutBtn').addEventListener('click', ()=>{
    currentPlayer = null;
    document.getElementById('player-dashboard').classList.add('hidden');
    document.getElementById('login-screen').classList.remove('hidden');
  });

  // ====== Admin Panel ======
  async function loadAdminPanel(){
    const snapshot = await db.ref('players').once('value');
    const list = document.getElementById('playersList');
    list.innerHTML = '';
    snapshot.forEach(s=>{
      const li = document.createElement('li');
      li.textContent = s.val().name + ' (Luck: '+s.val().luckNumber+')';
      list.appendChild(li);
    });
    const settingsSnap = await db.ref('settings').once('value');
    if(settingsSnap.exists()){
      document.getElementById('cardsPerPlayer').value = settingsSnap.val().cardsPerPlayer || 1;
    }
  }

  document.getElementById('addPlayerBtn').addEventListener('click', async ()=>{
    const name = capitalizeFirst(document.getElementById('newPlayerName').value.trim());
    const pass = document.getElementById('newPlayerPass').value.trim();
    if(!name || !pass) return alert('Enter name and password');
    const luck = ''+Math.floor(Math.random()*10)+Math.floor(Math.random()*10)+Math.floor(Math.random()*10)+Math.floor(Math.random()*10);
    const cardsPerPlayer = parseInt(document.getElementById('cardsPerPlayer').value) || 1;
    const cards = [];
    for(let i=0;i<cardsPerPlayer;i++){
      const grid = generateBingoCard();
      const marks = Array(5).fill(0).map(()=>Array(5).fill(false));
      cards.push({grid, marks});
    }
    await db.ref('players').push({name, password: pass, luckNumber: luck, cards});
    loadAdminPanel();
  });

  document.getElementById('resetAllBtn').addEventListener('click', async ()=>{
    if(!confirm('Reset all players?')) return;
    const snapshot = await db.ref('players').once('value');
    snapshot.forEach(s=>{
      const player = s.val();
      player.cards.forEach(card=>card.marks = Array(5).fill(0).map(()=>Array(5).fill(false)));
      db.ref('players/'+s.key).set(player);
    });
    alert('All player cards reset!');
  });

  document.getElementById('saveSettingsBtn').addEventListener('click', async ()=>{
    const cardsPerPlayer = parseInt(document.getElementById('cardsPerPlayer').value);
    await db.ref('settings').set({cardsPerPlayer});
    alert('Settings saved!');
  });

  document.getElementById('adminLogoutBtn').addEventListener('click', ()=>{
    document.getElementById('admin-dashboard').classList.add('hidden');
    document.getElementById('login-screen').classList.remove('hidden');
  });

</script>

</body>
</html>
