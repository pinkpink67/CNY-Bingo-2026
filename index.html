<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mobile Bingo Game</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        /* SIMPLIFIED CSS - Remove complex transitions and effects */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: #333;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            width: 100%;
            max-width: 500px;
            background-color: white;
            border-radius: 20px;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            margin: 20px 0;
        }
        
        .header {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            text-align: center;
            padding: 25px 20px;
        }
        
        .header h1 {
            font-size: 1.8rem;
            margin-bottom: 5px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 0.95rem;
        }
        
        .content {
            padding: 25px 20px;
        }
        
        /* Login Screen */
        #loginScreen {
            text-align: center;
        }
        
        .login-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 25px;
        }
        
        .input-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
            text-align: left;
        }
        
        .input-group label {
            font-weight: 600;
            font-size: 1rem;
        }
        
        .input-group input {
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1rem;
        }
        
        .input-group input:focus {
            border-color: #6a11cb;
            outline: none;
        }
        
        .btn {
            padding: 16px;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .btn-primary {
            background-color: #6a11cb;
            color: white;
        }
        
        .btn-secondary {
            background-color: #f0f0f0;
            color: #333;
        }
        
        .btn-small {
            padding: 12px 20px;
            font-size: 0.9rem;
        }
        
        .btn-danger {
            background-color: #dc3545;
            color: white;
        }
        
        .players-count {
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 10px;
            font-size: 0.9rem;
        }
        
        .players-count span {
            font-weight: 700;
            color: #6a11cb;
        }
        
        .admin-login-link {
            margin-top: 15px;
            font-size: 0.9rem;
        }
        
        .admin-login-link a {
            color: #6a11cb;
            text-decoration: none;
            font-weight: 600;
        }
        
        /* Game Screen */
        #gameScreen {
            display: none;
        }
        
        .player-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .player-name {
            font-size: 1.3rem;
            font-weight: 700;
            color: #6a11cb;
        }
        
        .card-counter {
            background-color: #f0f0f0;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: 600;
        }
        
        .bingo-card-container {
            background-color: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
        }
        
        .bingo-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
        }
        
        .bingo-cell {
            aspect-ratio: 1;
            background-color: white;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.2rem;
            cursor: pointer;
            user-select: none;
            box-shadow: 0 3px 5px rgba(0, 0, 0, 0.05);
        }
        
        .bingo-cell.free {
            background-color: #ffd166;
            color: #333;
        }
        
        .bingo-cell.marked {
            background-color: #6a11cb;
            color: white;
        }
        
        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .controls .btn {
            flex: 1;
        }
        
        .footer {
            margin-top: 20px;
            text-align: center;
            font-size: 0.85rem;
            color: #777;
        }
        
        /* Loading indicator */
        .loading-indicator {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            z-index: 9999;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 20px;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #6a11cb;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Error display */
        .error-message {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            z-index: 10000;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 20px;
            padding: 20px;
            text-align: center;
        }
        
        .error-message h3 {
            color: #dc3545;
        }
        
        .error-message pre {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            max-width: 90%;
            overflow: auto;
            font-family: monospace;
            font-size: 12px;
            text-align: left;
        }
        
        /* Debug panel */
        .debug-panel {
            position: fixed;
            bottom: 10px;
            right: 10px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-size: 12px;
            font-family: monospace;
            z-index: 1000;
            display: none;
        }
        
        /* Connection Status */
        .connection-status {
            position: fixed;
            top: 10px;
            left: 10px;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            z-index: 999;
            background: white;
            border: 1px solid #ddd;
        }
        
        /* Responsive */
        @media (max-width: 480px) {
            .container {
                border-radius: 15px;
            }
            
            .header {
                padding: 20px 15px;
            }
            
            .content {
                padding: 20px 15px;
            }
            
            .bingo-cell {
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Indicator -->
    <div class="loading-indicator" id="loadingIndicator">
        <div class="loading-spinner"></div>
        <p id="loadingText">Loading game...</p>
    </div>
    
    <!-- Error Display -->
    <div class="error-message" id="errorMessage">
        <h3><i class="fas fa-exclamation-triangle"></i> Game Error</h3>
        <p id="errorText">An error occurred while loading the game.</p>
        <pre id="errorDetails"></pre>
        <button class="btn btn-primary" onclick="location.reload()">
            <i class="fas fa-redo"></i> Reload Game
        </button>
        <button class="btn btn-secondary" onclick="resetGame()">
            <i class="fas fa-trash"></i> Reset Game Data
        </button>
    </div>
    
    <!-- Connection Status -->
    <div class="connection-status" id="connectionStatus">Connecting...</div>
    
    <!-- Debug Panel (Ctrl+D to toggle) -->
    <div class="debug-panel" id="debugPanel">
        <div>Debug Info</div>
        <div id="debugInfo"></div>
    </div>
    
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-dice"></i> Mobile Bingo</h1>
            <p>Login to play with your unique bingo cards</p>
        </div>
        
        <div class="content">
            <!-- Login Screen -->
            <div id="loginScreen">
                <h2>Welcome to Bingo!</h2>
                <p>Enter your name to join the game. Maximum <span id="maxPlayersDisplay">30</span> players.</p>
                
                <form class="login-form" id="loginForm">
                    <div class="input-group">
                        <label for="playerName">Your Name</label>
                        <input type="text" id="playerName" placeholder="Enter your name" required autocomplete="off">
                    </div>
                    
                    <div class="input-group">
                        <label for="gameRoomCode">Game Room Code (Optional)</label>
                        <input type="text" id="gameRoomCode" placeholder="Leave empty for default room">
                    </div>
                    
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-sign-in-alt"></i> Join Game
                    </button>
                </form>
                
                <div class="players-count">
                    Players joined: <span id="currentPlayers">0</span> / <span id="maxPlayers">30</span>
                </div>
                
                <div class="admin-login-link">
                    <a href="#" id="adminLoginLink">Admin Login</a>
                </div>
            </div>
            
            <!-- Game Screen -->
            <div id="gameScreen">
                <div class="player-info">
                    <div class="player-name" id="displayPlayerName">Player</div>
                    <div class="card-counter">Card <span id="currentCard">1</span> of <span id="totalCards">3</span></div>
                </div>
                
                <div class="bingo-card-container">
                    <div class="bingo-grid" id="bingoGrid">
                        <!-- Bingo cells will be generated here -->
                    </div>
                </div>
                
                <div class="controls">
                    <button class="btn btn-secondary" id="prevCardBtn">
                        <i class="fas fa-arrow-left"></i> Back
                    </button>
                    <button class="btn btn-primary" id="nextCardBtn">
                        Next <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
                
                <button class="btn btn-primary" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
            
            <!-- Admin Screen -->
            <div id="adminScreen">
                <h2><i class="fas fa-cogs"></i> Admin Controls</h2>
                <p>For admin access, use ID: <strong>admin</strong> and Password: <strong>1234</strong></p>
                <button class="btn btn-primary" id="adminLogoutBtn" style="margin-top: 20px;">
                    <i class="fas fa-sign-out-alt"></i> Exit Admin
                </button>
            </div>
        </div>
    </div>
    
    <div class="footer">
        <p>Mobile Bingo Game &copy; 2023</p>
    </div>

    <script>
        // ==================== SIMPLIFIED GAME LOGIC ====================
        
        // Debug mode
        const DEBUG_MODE = true;
        
        // Game state
        let gameState = {
            players: [],
            currentPlayer: null,
            currentCardIndex: 0,
            settings: {
                maxPlayers: 30,
                cardsPerPlayer: 3
            }
        };
        
        // Admin credentials
        const ADMIN_CREDENTIALS = {
            id: "admin",
            password: "1234"
        };
        
        // ==================== DEBUG FUNCTIONS ====================
        
        function debugLog(message, data = null) {
            if (DEBUG_MODE) {
                console.log(`[BINGO] ${message}`, data || '');
                updateDebugInfo(message);
            }
        }
        
        function updateDebugInfo(message) {
            const debugPanel = document.getElementById('debugPanel');
            const debugInfo = document.getElementById('debugInfo');
            
            if (debugPanel && debugInfo) {
                const time = new Date().toLocaleTimeString();
                debugInfo.innerHTML = `${time}: ${message}<br>${debugInfo.innerHTML}`;
            }
        }
        
        function showError(error, details = '') {
            debugLog(`ERROR: ${error}`);
            
            const errorMessage = document.getElementById('errorMessage');
            const errorText = document.getElementById('errorText');
            const errorDetails = document.getElementById('errorDetails');
            
            if (errorMessage && errorText && errorDetails) {
                errorText.textContent = error;
                errorDetails.textContent = details || error.stack || 'No details available';
                errorMessage.style.display = 'flex';
                document.getElementById('loadingIndicator').style.display = 'none';
            }
            
            // Also log to console
            console.error('Bingo Game Error:', error);
            if (details) console.error('Error Details:', details);
        }
        
        function resetGame() {
            if (confirm('Are you sure you want to reset ALL game data? This will delete all players and settings.')) {
                localStorage.clear();
                location.reload();
            }
        }
        
        // ==================== CORE GAME FUNCTIONS ====================
        
        function generateBingoCards() {
            debugLog('Generating bingo cards...');
            const cards = [];
            
            // Standard Bingo ranges
            const ranges = {
                B: [1, 15],
                I: [16, 30],
                N: [31, 45],
                G: [46, 60],
                O: [61, 75]
            };
            
            // Generate 150 cards (simplified to 30 for faster loading)
            const totalCards = 30; // Reduced from 150 for performance
            for (let cardId = 1; cardId <= totalCards; cardId++) {
                const card = { id: cardId, numbers: {} };
                
                for (let col = 0; col < 5; col++) {
                    const letter = Object.keys(ranges)[col];
                    const [min, max] = ranges[letter];
                    const columnNumbers = [];
                    
                    while (columnNumbers.length < 5) {
                        const num = Math.floor(Math.random() * (max - min + 1)) + min;
                        if (!columnNumbers.includes(num)) {
                            columnNumbers.push(num);
                        }
                    }
                    
                    card.numbers[letter] = columnNumbers;
                }
                
                card.numbers.N[2] = "FREE";
                cards.push(card);
            }
            
            debugLog(`Generated ${cards.length} bingo cards`);
            return cards;
        }
        
        function assignCardsToPlayer(player, cardsPool) {
            debugLog(`Assigning cards to player: ${player.name}`);
            const assignedCards = [];
            const cardsToAssign = gameState.settings.cardsPerPlayer;
            
            // Get available cards (not issued yet)
            const availableCards = cardsPool.filter(card => 
                !gameState.players.some(p => 
                    p.cards && p.cards.some(c => c.id === card.id)
                )
            );
            
            // If not enough cards, use any cards
            const cardsToUse = availableCards.length >= cardsToAssign ? availableCards : cardsPool;
            
            for (let i = 0; i < cardsToAssign; i++) {
                if (cardsToUse.length === 0) break;
                
                const randomIndex = Math.floor(Math.random() * cardsToUse.length);
                const selectedCard = cardsToUse[randomIndex];
                assignedCards.push(selectedCard);
                
                // Remove from pool to avoid duplicates for same player
                cardsToUse.splice(randomIndex, 1);
            }
            
            player.cards = assignedCards;
            debugLog(`Assigned ${assignedCards.length} cards to ${player.name}`);
            return assignedCards;
        }
        
        function updateCardDisplay() {
            try {
                if (!gameState.currentPlayer || !gameState.currentPlayer.cards) {
                    throw new Error('No player or cards found');
                }
                
                const card = gameState.currentPlayer.cards[gameState.currentCardIndex];
                if (!card) {
                    throw new Error(`Card not found at index ${gameState.currentCardIndex}`);
                }
                
                const bingoGrid = document.getElementById('bingoGrid');
                const currentCardSpan = document.getElementById('currentCard');
                
                if (!bingoGrid || !currentCardSpan) {
                    throw new Error('Required elements not found');
                }
                
                currentCardSpan.textContent = gameState.currentCardIndex + 1;
                bingoGrid.innerHTML = '';
                
                const letters = ['B', 'I', 'N', 'G', 'O'];
                
                for (let row = 0; row < 5; row++) {
                    for (let col = 0; col < 5; col++) {
                        const cell = document.createElement('div');
                        const letter = letters[col];
                        const number = card.numbers[letter][row];
                        
                        cell.className = 'bingo-cell';
                        cell.textContent = number;
                        
                        if (col === 2 && row === 2) {
                            cell.classList.add('free');
                        }
                        
                        cell.addEventListener('click', function() {
                            if (!this.classList.contains('free')) {
                                this.classList.toggle('marked');
                            }
                        });
                        
                        bingoGrid.appendChild(cell);
                    }
                }
                
                debugLog('Card display updated');
            } catch (error) {
                showError('Failed to update card display', error);
            }
        }
        
        // ==================== UI FUNCTIONS ====================
        
        function showScreen(screenId) {
            ['loginScreen', 'gameScreen', 'adminScreen'].forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.style.display = id === screenId ? 'block' : 'none';
                }
            });
        }
        
        function updatePlayersCount() {
            const currentPlayersElement = document.getElementById('currentPlayers');
            const maxPlayersElement = document.getElementById('maxPlayers');
            const maxPlayersDisplay = document.getElementById('maxPlayersDisplay');
            
            if (currentPlayersElement) {
                currentPlayersElement.textContent = gameState.players.length;
            }
            if (maxPlayersElement && maxPlayersDisplay) {
                maxPlayersElement.textContent = gameState.settings.maxPlayers;
                maxPlayersDisplay.textContent = gameState.settings.maxPlayers;
            }
        }
        
        // ==================== EVENT HANDLERS ====================
        
        function setupEventListeners() {
            try {
                // Login form
                const loginForm = document.getElementById('loginForm');
                if (loginForm) {
                    loginForm.addEventListener('submit', handleLogin);
                }
                
                // Admin login link
                const adminLink = document.getElementById('adminLoginLink');
                if (adminLink) {
                    adminLink.addEventListener('click', showAdminLogin);
                }
                
                // Navigation buttons
                const prevBtn = document.getElementById('prevCardBtn');
                const nextBtn = document.getElementById('nextCardBtn');
                if (prevBtn) prevBtn.addEventListener('click', showPrevCard);
                if (nextBtn) nextBtn.addEventListener('click', showNextCard);
                
                // Logout buttons
                const logoutBtn = document.getElementById('logoutBtn');
                const adminLogoutBtn = document.getElementById('adminLogoutBtn');
                if (logoutBtn) logoutBtn.addEventListener('click', handleLogout);
                if (adminLogoutBtn) adminLogoutBtn.addEventListener('click', () => showScreen('loginScreen'));
                
                debugLog('Event listeners setup complete');
            } catch (error) {
                showError('Failed to setup event listeners', error);
            }
        }
        
        function handleLogin(e) {
            e.preventDefault();
            
            const playerNameInput = document.getElementById('playerName');
            const playerName = playerNameInput ? playerNameInput.value.trim() : '';
            const roomCodeInput = document.getElementById('gameRoomCode');
            
            if (!playerName) {
                alert('Please enter your name');
                return;
            }
            
            // Check for admin login
            if (playerName.toLowerCase() === ADMIN_CREDENTIALS.id) {
                const password = prompt('Enter Admin Password:');
                if (password === ADMIN_CREDENTIALS.password) {
                    showScreen('adminScreen');
                    if (playerNameInput) playerNameInput.value = '';
                } else {
                    alert('Invalid password');
                }
                return;
            }
            
            // Check if name already exists
            const existingPlayer = gameState.players.find(p => 
                p.name.toLowerCase() === playerName.toLowerCase()
            );
            
            if (existingPlayer) {
                // Ask if this is the same person
                const isSamePerson = confirm(`Name "${playerName}" already exists. Is this you?`);
                if (isSamePerson) {
                    gameState.currentPlayer = existingPlayer;
                    gameState.currentCardIndex = 0;
                    document.getElementById('displayPlayerName').textContent = existingPlayer.name;
                    document.getElementById('totalCards').textContent = existingPlayer.cards.length;
                    updateCardDisplay();
                    showScreen('gameScreen');
                    debugLog(`Existing player logged in: ${playerName}`);
                } else {
                    // Create new player with different name
                    const newName = `${playerName}${gameState.players.length + 1}`;
                    alert(`Using name "${newName}" instead.`);
                    createNewPlayer(newName);
                }
            } else {
                createNewPlayer(playerName);
            }
            
            if (playerNameInput) playerNameInput.value = '';
        }
        
        function createNewPlayer(playerName) {
            debugLog(`Creating new player: ${playerName}`);
            
            // Check player limit
            if (gameState.players.length >= gameState.settings.maxPlayers) {
                alert(`Sorry, the game is full! Maximum ${gameState.settings.maxPlayers} players allowed.`);
                return;
            }
            
            // Generate cards pool
            const cardsPool = generateBingoCards();
            
            // Create player
            const newPlayer = {
                id: gameState.players.length + 1,
                name: playerName,
                cards: []
            };
            
            // Assign cards
            assignCardsToPlayer(newPlayer, cardsPool);
            
            // Add to game state
            gameState.players.push(newPlayer);
            gameState.currentPlayer = newPlayer;
            gameState.currentCardIndex = 0;
            
            // Update UI
            document.getElementById('displayPlayerName').textContent = newPlayer.name;
            document.getElementById('totalCards').textContent = newPlayer.cards.length;
            updateCardDisplay();
            updatePlayersCount();
            showScreen('gameScreen');
            
            // Save to localStorage
            saveGameState();
            
            debugLog(`New player created: ${playerName} with ${newPlayer.cards.length} cards`);
            alert(`Welcome ${playerName}! You have received ${newPlayer.cards.length} bingo cards.`);
        }
        
        function showAdminLogin(e) {
            if (e) e.preventDefault();
            
            const adminId = prompt('Enter Admin ID:');
            if (!adminId) return;
            
            if (adminId !== ADMIN_CREDENTIALS.id) {
                alert('Invalid Admin ID');
                return;
            }
            
            const password = prompt('Enter Admin Password:');
            if (!password) return;
            
            if (password !== ADMIN_CREDENTIALS.password) {
                alert('Invalid Password');
                return;
            }
            
            showScreen('adminScreen');
        }
        
        function showPrevCard() {
            if (gameState.currentCardIndex > 0) {
                gameState.currentCardIndex--;
                updateCardDisplay();
            }
        }
        
        function showNextCard() {
            if (gameState.currentPlayer && 
                gameState.currentCardIndex < gameState.currentPlayer.cards.length - 1) {
                gameState.currentCardIndex++;
                updateCardDisplay();
            }
        }
        
        function handleLogout() {
            if (confirm('Are you sure you want to logout?')) {
                gameState.currentPlayer = null;
                gameState.currentCardIndex = 0;
                showScreen('loginScreen');
                debugLog('Player logged out');
            }
        }
        
        // ==================== DATA PERSISTENCE ====================
        
        function saveGameState() {
            try {
                localStorage.setItem('bingoGameState', JSON.stringify(gameState));
                debugLog('Game state saved to localStorage');
            } catch (error) {
                showError('Failed to save game state', error);
            }
        }
        
        function loadGameState() {
            try {
                const saved = localStorage.getItem('bingoGameState');
                if (saved) {
                    const parsed = JSON.parse(saved);
                    
                    // Merge saved state with defaults
                    gameState.players = parsed.players || [];
                    gameState.settings = { ...gameState.settings, ...(parsed.settings || {}) };
                    
                    debugLog(`Loaded ${gameState.players.length} players from localStorage`);
                }
            } catch (error) {
                showError('Failed to load game state', error);
            }
        }
        
        // ==================== INITIALIZATION ====================
        
        function initGame() {
            try {
                debugLog('Initializing game...');
                
                // Update loading text
                const loadingText = document.getElementById('loadingText');
                if (loadingText) loadingText.textContent = 'Loading game...';
                
                // Show loading indicator
                const loadingIndicator = document.getElementById('loadingIndicator');
                if (loadingIndicator) loadingIndicator.style.display = 'flex';
                
                // Update connection status
                const connectionStatus = document.getElementById('connectionStatus');
                if (connectionStatus) {
                    connectionStatus.textContent = 'Online';
                    connectionStatus.style.background = '#4CAF50';
                    connectionStatus.style.color = 'white';
                }
                
                // Load saved game state
                loadGameState();
                
                // Update UI
                updatePlayersCount();
                
                // Setup event listeners
                setupEventListeners();
                
                // Show login screen
                showScreen('loginScreen');
                
                // Hide loading indicator
                setTimeout(() => {
                    if (loadingIndicator) loadingIndicator.style.display = 'none';
                    debugLog('Game initialization complete');
                }, 500);
                
            } catch (error) {
                showError('Failed to initialize game', error);
            }
        }
        
        // ==================== DEBUG KEYBOARD SHORTCUTS ====================
        
        document.addEventListener('keydown', function(e) {
            // Ctrl+D to toggle debug panel
            if (e.ctrlKey && e.key === 'd') {
                e.preventDefault();
                const debugPanel = document.getElementById('debugPanel');
                if (debugPanel) {
                    debugPanel.style.display = debugPanel.style.display === 'none' ? 'block' : 'none';
                }
            }
            
            // Ctrl+R to reload
            if (e.ctrlKey && e.key === 'r') {
                e.preventDefault();
                location.reload();
            }
            
            // Ctrl+Shift+R to reset
            if (e.ctrlKey && e.shiftKey && e.key === 'R') {
                e.preventDefault();
                resetGame();
            }
        });
        
        // ==================== START GAME ====================
        
        // Start initialization when page loads
        window.addEventListener('DOMContentLoaded', function() {
            debugLog('DOM loaded, starting game initialization...');
            initGame();
        });
        
        // Fallback timeout in case initialization hangs
        setTimeout(() => {
            const loadingIndicator = document.getElementById('loadingIndicator');
            if (loadingIndicator && loadingIndicator.style.display === 'flex') {
                showError('Game initialization timeout', 'The game took too long to load. Please try reloading.');
            }
        }, 10000); // 10 second timeout
        
    </script>
</body>
</html>
